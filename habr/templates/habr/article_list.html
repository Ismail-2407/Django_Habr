{% extends 'habr/base.html' %}
{% load humanize %}

{% block title %}Articles - Habr-like News{% endblock %}

{% block content %}
<div class="container py-3">
  <div class="mb-4">
    <h1 class="text-white fw-bold mb-1">Моя лента</h1>
    <p class="text-white-50">Читайте свежие статьи от пользователей платформы</p>
  </div>

  {% if articles %}
    {% for article in articles %}
    <article class="card bg-dark border-0 shadow-sm mb-4 p-4">
      <div class="d-flex align-items-center mb-2">
        <small class="text-primary fw-bold text-uppercase">СТАТЬЯ</small>
        <span class="text-white-50 ms-2 small">
          {{ article.author.username }} • {{ article.created_at|naturaltime }}
        </span>
      </div>

      <h3 class="text-white mb-2">{{ article.title }}</h3>
      <p class="text-white-50 mb-3">{{ article.summary|truncatewords:30 }}</p>

      {% if article.image_display_url %}
      <img
        src="{{ article.image_display_url }}"
        alt="{{ article.title }}"
        class="rounded w-100 mb-3"
        style="max-height: 380px; object-fit: cover;"
      />
      {% endif %}

      <div class="d-flex flex-wrap align-items-center gap-3 mb-3">
        <span class="badge bg-primary">{{ article.category.name }}</span>
        <span class="badge bg-success">
          <i class="bi bi-star-fill"></i> {{ article.rating|default:"0.0" }}
        </span>
        <span class="text-white-50 small">
          <i class="bi bi-clock"></i> {{ article.created_at|naturaltime }}
        </span>
      </div>

      <div class="d-flex justify-content-between align-items-center">
        <div class="d-flex gap-2">
          {% if request.user.is_authenticated %}
          <form
            method="post"
            action="{% url 'habr:toggle_like' article.pk %}"
            class="d-inline"
          >
            {% csrf_token %}
            <button type="submit" class="btn btn-dark border-0 d-flex align-items-center gap-1 like-btn">
              <i class="bi bi-hand-thumbs-up text-success"></i>
              <span class="text-white">{{ article.likes_count|default:0 }}</span>
            </button>
          </form>

          <form
            method="post"
            action="{% url 'habr:toggle_dislike' article.pk %}"
            class="d-inline"
          >
            {% csrf_token %}
            <button type="submit" class="btn btn-dark border-0 d-flex align-items-center gap-1 dislike-btn">
              <i class="bi bi-hand-thumbs-down text-danger"></i>
              <span class="text-white">{{ article.dislikes_count|default:0 }}</span>
            </button>
          </form>

          <form
            method="post"
            action="{% url 'habr:toggle_bookmark' article.pk %}"
            class="d-inline"
          >
            {% csrf_token %}
            <button type="submit" class="btn btn-dark border-0 d-flex align-items-center gap-1 bookmark-btn">
              <i class="bi bi-bookmark{% if is_bookmarked %}-fill{% endif %} text-warning"></i>
            </button>
          </form>
          {% endif %}
        </div>

        <a href="{% url 'habr:article_detail' article.pk %}" class="btn btn-sm btn-accent">
          Читать <i class="bi bi-arrow-right"></i>
        </a>
      </div>
    </article>
    {% endfor %}
  {% else %}
  <div class="empty-state text-center text-white mt-5">
    <i class="bi bi-inbox" style="font-size: 60px; opacity: 0.6"></i>
    <h3 class="mt-3">Нет опубликованных статей</h3>
    <p class="text-white-50">Будь первым, кто создаст!</p>
    {% if request.user.is_authenticated %}
    <a href="{% url 'habr:article_create' %}" class="btn btn-accent mt-3">
      <i class="bi bi-plus-circle"></i> Создать статью
    </a>
    {% else %}
    <a href="{% url 'habr:login' %}" class="btn btn-accent mt-3">
      <i class="bi bi-box-arrow-in-right"></i> Войти, чтобы создать
    </a>
    {% endif %}
  </div>
  {% endif %}
</div>

<style>
  .card {
    transition: all 0.2s ease-in-out;
  }
  .card:hover {
    transform: translateY(-3px);
    box-shadow: 0 0 15px rgba(77, 163, 255, 0.2);
  }

  .like-btn:hover i {
    color: #00ff66 !important;
    transform: scale(1.3);
  }
  .dislike-btn:hover i {
    color: #ff3b3b !important;
    transform: scale(1.3);
  }
  .bookmark-btn:hover i {
    color: #ffd700 !important;
    transform: scale(1.3);
  }
  .like-btn i,
  .dislike-btn i,
  .bookmark-btn i {
    transition: all 0.25s ease;
  }

  .btn-accent {
    background-color: #4da3ff;
    color: #fff;
    border: none;
  }
  .btn-accent:hover {
    background-color: #3385e6;
    color: #fff;
  }
</style>
{% endblock %}
